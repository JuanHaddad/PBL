<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Gráfico da Onda Transversal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body>
<h1>Gráfico da Onda Transversal</h1>

<canvas id="graficoOnda"></canvas>

<!-- Botão para voltar ao formulário -->
<br><br>
<a href="/formulario" class="btn-voltar">Voltar ao formulário</a>

<script th:inline="javascript">
<<<<<<< Updated upstream
    // Definir os parâmetros recebidos do back-end
    const duracaoSimulacao = /*[[${duracao}]]*/ 7.5;  // Exemplo: 7.5 segundos
    const frequencia = /*[[${frequencia}]]*/ 0.2;  // Frequência da onda em Hz
    const comprimentoOnda = /*[[${comprimentoOnda}]]*/ 1.0;  // Comprimento da onda em metros
    const erroMaximo = /*[[${erroMaximo}]]*/ 0.001;  // Erro máximo tolerável
=======
    let pontos = /*[[${pontos}]]*/ [];  // Lista de pontos da onda, enviada do servidor

    // Configurando o gráfico com Chart.js
    var ctx = document.getElementById('graficoOnda').getContext('2d');
    var chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: pontos.map(p => p.x),  // Usamos os valores de X dos pontos
            datasets: [{
                label: 'Onda Transversal',
                data: pontos.map(p => p.y),  // Usamos os valores de Y dos pontos
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                fill: false
            }]
        },
        options: {
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    min: 0,
                    max: 2
                },
                y: {
                    beginAtZero: false,
                    min: -1,
                    max: 1
                }
            }
        }
    });
</script>
>>>>>>> Stashed changes

    // Variáveis de animação
    let t = 0;  // Tempo inicial
    const passoTempo = 0.05;  // Passo de tempo (em segundos)
    const fps = 60;  // Frames por segundo da animação

    // Função para calcular o seno usando série de Taylor
    function calcularSenoTaylor(valor, erroMaximo) {
        let termo = valor;  // Primeiro termo da série (x^1 / 1!)
        let soma = termo;
        let n = 1;

        while (Math.abs(termo) > erroMaximo) {
            termo *= -1 * valor * valor / ((2 * n) * (2 * n + 1));  // Termo da série
            soma += termo;
            n++;
        }

        return soma;
    }

    // Função para gerar os pontos da onda com base no tempo
    function calcularPontosOnda(t) {
        let dadosX = [];
        let dadosY = [];
        const passoX = 0.01;  // Espaçamento entre pontos (1 cm)

        for (let x = 0; x <= 1; x += passoX) {
            // Fórmula da onda: y(x, t) = sin(2π(f * t - x / λ)) usando Taylor
            let argumento = 2 * Math.PI * (frequencia * t - x / comprimentoOnda);
            let y = calcularSenoTaylor(argumento, erroMaximo);

            // Verificando se o valor de y é NaN
            if (isNaN(y)) {
                console.error("Erro no cálculo de y: argumento = ", argumento, ", y = ", y);
            }

            dadosX.push(x);
            dadosY.push(y);
        }

        return { dadosX, dadosY };
    }

    // Configurando o gráfico com Chart.js
    var ctx = document.getElementById('graficoOnda').getContext('2d');
    var chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],  // Iniciamos vazio
            datasets: [{
                label: 'Onda Transversal',
                data: [],
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                fill: false
            }]
        },
        options: {
            animation: false,  // Desabilitamos a animação nativa, faremos manualmente
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    min: 0,
                    max: 1
                },
                y: {
                    beginAtZero: true,
                    min: -1,
                    max: 1
                }
            }
        }
    });

    // Função para atualizar o gráfico
    function atualizarGrafico() {
        if (t <= duracaoSimulacao) {
            let pontosOnda = calcularPontosOnda(t);

            chart.data.labels = pontosOnda.dadosX;  // Atualizamos os valores de x
            chart.data.datasets[0].data = pontosOnda.dadosY;  // Atualizamos os valores de y
            chart.update();

            t += passoTempo;  // Avançamos o tempo
            setTimeout(atualizarGrafico, 1000 / fps);  // Próximo frame da animação
        }
    }

    // Iniciar a animação do gráfico
    atualizarGrafico();
</script>
</body>
</html>
